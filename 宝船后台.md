## :love_letter:babyship/宝船

#### 已知bug收集

* 预览图为空 => 有，不能实时刷新
  * teacher列表下可复现
* edit内容目前数据库为varchar（10000）
* 添加用户时，需要去数据库在user_role添加记录
* 目前用户是两小时刷新退出，调转页面暂时不退出

#### 拓展与遗失

* 删除是数据库状态改变，并非真正的删除
* 关于github的自动生成图像技术（碰运气的随机生成规则）
* https://segmentfault.com/a/1190000010684211 

****

### 后台介绍:boom:

#### 简单概述（后台）

* 相关技术栈
  * springBoot+springSecurity+jwt+mybatis+jpa（token控权）

* 参考博文
  * https://blog.csdn.net/Winter_chen001/article/details/80010967
  * https://blog.csdn.net/qq_35494808/article/details/81537415#commentBox
  * https://echisan.cn/article/16
  * https://segmentfault.com/q/1010000008709916
  * https://blog.csdn.net/cowshield/article/details/80841034
  * https://segmentfault.com/q/1010000013308701
  * https://segmentfault.com/q/1010000010893139
  * 其他关于cookie和hearder以及前后台token传递参考其他书签和日志

#### 主要过程

##### 构建框架结构

###### 1、添加依赖

~~~~java
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.winterchen</groupId>
    <artifactId>springboot2-mybatis-demo</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <packaging>jar</packaging>

    <name>springboot2-mybatis-demo</name>
    <description>Demo project for Spring Boot</description>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.1.RELEASE</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>1.3.2</version>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
            <version>3.4</version>
        </dependency>


        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-core</artifactId>
        </dependency>
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
        </dependency>
        <dependency>
            <groupId>com.fasterxml.jackson.datatype</groupId>
            <artifactId>jackson-datatype-joda</artifactId>
        </dependency>
        <dependency>
            <groupId>com.fasterxml.jackson.module</groupId>
            <artifactId>jackson-module-parameter-names</artifactId>
        </dependency>
        <!-- 分页插件 -->
        <dependency>
            <groupId>com.github.pagehelper</groupId>
            <artifactId>pagehelper-spring-boot-starter</artifactId>
            <version>1.2.5</version>
        </dependency>
        <!-- alibaba的druid数据库连接池 -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.1.9</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>


</project>

---------------------
https://blog.csdn.net/Winter_chen001/article/details/80010967?utm_source=copy 
~~~~

###### 2、启动类配置自动扫描dao路径

```java
@SpringBootApplication
@EnableJpaAuditing
//@EnableWebSecurity
@MapperScan("com.jiahanglee.babyship.dao")
public class BabyshipApplication {

   public static void main(String[] args) {
      SpringApplication.run(BabyshipApplication.class, args);
   }
}
```

######3、配置application.yml文件

~~~~yml
#这里有三个yml文件，分为生产和测试，分别为dev和prod
application_dev.yml如下：
server:
  port: 8002
web.upload-path: C:\Users\Administrator\Desktop
application.yml作为主要配置文件，内容如下：
spring:
  profiles:
    active: dev  #选择生产或测试
  datasource:
    name: mysql_dev
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
          #监控统计拦截的filters
          filters: stat
          driver-class-name: com.mysql.jdbc.Driver
          url: jdbc:mysql://127.0.0.1:3306/201807031?useUnicode=true&characterEncoding=utf-8&useSSL=false&amp;useOldAliasMetadataBehavior=true
          username: root
          password: 123456
          initial-size: 1
          min-idle: 1
          max-active: 20
          max-wait: 60000
          time-between-eviction-runs-millis: 60000
          min-evictable-idle-time-millis: 300000
          validation-query: SELECT 'x'
          test-while-idle: true
          test-on-borrow: false
          test-on-return: false
          #打开PSCache，并指定每个连接上PSCache的大小。oracle设为true，mysql设为false。分库分表较多推荐设置为false
          pool-prepared-statements: false
          max-pool-prepared-statement-per-connection-size: 20
          ## jackson是设置全局时区和格式(不如在sql中直接上)
  jackson:
      date-format: yyyy-MM-dd HH:mm:ss
      time-zone: GMT+8
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    database-platform: org.hibernate.dialect.MySQL5InnoDBDialect #设置方言解决无外键问题
  security:
    user:
      name: jiahanglee
      password: 123456

server:
  servlet:
    context-path: /babyship
## 该配置节点为独立的节点，有很多REN将这个配置放在spring的节点下，导致配置无法被识别
mybatis:
  mapper-locations: classpath:mapper/TeacherDao.xml ,classpath:mapper/NewsDao.xml ,classpath:mapper/UserDao.xml
  #注意：一定要对应mapper映射xml文件的所在路径

  type-aliases-package: com.jiahanglee.babyship.entity  # 注意：对应实体类的路径

#pagehelper
pagehelper:
    helperDialect: mysql
    reasonable: true
    supportMethodsArguments: true
    params: count=countSql
    returnPageInfo: check

~~~~

###### 4、热部署

1. 添加依赖
2. IDE设置工程自动构建

* 参考博文：https://blog.csdn.net/xusheng_Mr/article/details/78771746 

###### 5、jpa表映射（如：manyTomany）

~~~~yml
   jpa:
      hibernate:
        ddl-auto: update
      show-sql: true
      database-platform: org.hibernate.dialect.MySQL5InnoDBDialect #设置方言解决无外键问题
~~~~

* 参考博文
  * https://blog.csdn.net/hanerer1314/article/details/78887454
  * https://www.jianshu.com/p/16d816ccef0c

###### 6、表数据必要字段

* 创建时间和更新时间
* status状态作为是非存在

###### 7、文件上传

###### 8、json、map数据转换

###### 9、异常处理



#### 总结经验









